Meteor.methods({
    'insertComment': function(comment, postid){
        Comments.insert({
            user: Meteor.userId(),
            date: new Date(),
            displayDate: moment().format("MMMM D, YYYY"),
            text: comment,
            postid: postid
        });
    },
    'register': function(username, password, email, avatar){

        if(!avatar)
            avatar = "data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABkAAD/4QO/aHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjUtYzAyMSA3OS4xNTQ5MTEsIDIwMTMvMTAvMjktMTE6NDc6MTYgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcFJpZ2h0cz0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3JpZ2h0cy8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBSaWdodHM6TWFya2VkPSJGYWxzZSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjA0ODAxMTc0MDcyMDY4MTE4MDgzQjlCRUU5QjkxQzk2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjFEQ0M4RjE3OUMxQzExRTNBRjc3QTQxRjIwNEY0NTc3IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjFEQ0M4RjE2OUMxQzExRTNBRjc3QTQxRjIwNEY0NTc3IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAoTWFjaW50b3NoKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAyODAxMTc0MDcyMDY4MTE4MDgzQTJBNjQyMUVGMkY3IiBzdFJlZjpkb2N1bWVudElE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";

        return Accounts.createUser({
            email:email,
            username:username,
            password: password,
            profile:{
                avatar: avatar,
                private: EDIT_PROFILE_PRIVATE_PROFILE,
                about: EDIT_PROFILE_ABOUT,
                firstname:"",
                lastname:"",
                feedType: EDIT_PROFILE_FEED_TYPE,
                follow: [],
                followers:[],
                language:"en",
                // New
                notifications: [],
                open_messages:[],
                messages: [],
                viewing_messages_of: null,
                posts_events:{
                    liked_posts:[],
                    shared_posts:[],
                    post_count: 0
                },
                cover: "/images/cover/background.jpg",
                cover_position:0
            }
        });

        console.log("userCreate: ", userCreate);

    },
    'resetNotifications': function(notifications){

        if(notifications.length > 0){

            for(var i = 0; i < notifications.length; i++){
                Notifications.update(
                    {_id: notifications[i]._id},
                    {
                        $set: {
                        new: false
                    }

                    })
            }
            }
        }

    });


